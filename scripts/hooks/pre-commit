#!/usr/bin/env bash
# Simple pre-commit hook to ensure Dart code is formatted, analyzed and tested
# TODO: verify MIT license headers automatically
set -euo pipefail

if command -v fvm >/dev/null 2>&1; then
  FVM_CMD="fvm flutter"
else
  FVM_CMD="flutter"
fi

# Only consider staged Dart files
STAGED_DART_FILES=$(git diff --cached --name-only -- '*.dart')

if [[ -n "$STAGED_DART_FILES" ]]; then
  # Format and analyze the staged files only
  $FVM_CMD format --set-exit-if-changed $STAGED_DART_FILES
  $FVM_CMD analyze $STAGED_DART_FILES
fi

# Always run tests with coverage
$FVM_CMD test --coverage
